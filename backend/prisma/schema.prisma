// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reservations Reservation[]
  restaurants  Restaurant[]

  @@map("users")
}

model Restaurant {
  id              Int     @id @default(autoincrement())
  userId          Int
  user            User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name            String
  description     String?
  contactEmail    String?
  contactPhone    String?
  widgetTheme     String  @default("light")
  shareToken      String  @unique
  workingHours    Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  locations       Location[]
  floors          Floor[]
  reservations    Reservation[]
  employees       Employee[]

  @@map("restaurants")
}

model Location {
  id              Int     @id @default(autoincrement())
  restaurantId    Int
  restaurant      Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  
  name            String
  address         String
  phone           String
  city            String?
  country         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("locations")
}

model Floor {
  id              Int     @id @default(autoincrement())
  restaurantId    Int
  restaurant      Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  
  name            String  @default("Floor 1")
  floorNumber     Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  tables          Table[]

  @@unique([restaurantId, floorNumber])
  @@map("floors")
}

model Table {
  id              Int     @id @default(autoincrement())
  floorId         Int
  floor           Floor   @relation(fields: [floorId], references: [id], onDelete: Cascade)
  workerId        Int?
  worker          Employee? @relation(fields: [workerId], references: [id], onDelete: SetNull)
  
  name            String
  shape           String  // round, square, rectangular
  capacity        Int
  status          String  @default("available") // available, occupied, reserved
  x               Float   // percentage position
  y               Float
  width           Float   // percentage size
  height          Float
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("tables")
}

model Employee {
  id              Int     @id @default(autoincrement())
  restaurantId    Int
  restaurant      Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  
  name            String
  email           String?
  phone           String?
  role            String  @default("waiter") // waiter, chef, manager, etc.
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  tables          Table[]

  @@map("employees")
}

model Reservation {
  id              Int     @id @default(autoincrement())
  userId          Int
  user            User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurantId    Int?
  restaurant      Restaurant? @relation(fields: [restaurantId], references: [id], onDelete: SetNull)
  
  title           String
  description     String?
  startTime       DateTime
  endTime         DateTime
  status          String  @default("confirmed") // confirmed, cancelled, completed
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("reservations")
}
